<xf:xccdf-fragment xmlns:xf="http://fedorahosted.org/sce-community-content/wiki/XCCDF-fragment" xmlns="http://checklists.nist.gov/xccdf/1.1" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  <Group id="xccdf_org.open-scap.sce-community-content_group_services_logging" selected="true">
    <title>Logging</title>

    <Rule id="xccdf_org.open-scap.sce-community-content_rule_services_logging-existence" selected="true">
      <title>Check existence of the log files.</title>
      <description>
        <xhtml:p>Log files should exist on all GNU/Linux systems.</xhtml:p>
        <xhtml:p>Missing log files may be proof that the system has been compromised.</xhtml:p>
        <xhtml:p>The following log files will be checked:
          <xhtml:ul>
            <xhtml:li>/var/log/wtmp</xhtml:li>
            <xhtml:li>/var/log/btmp</xhtml:li>
            <xhtml:li>/var/log/lastlog</xhtml:li>
            <xhtml:li>/var/log/utmp</xhtml:li>
            <xhtml:li>/var/log/messages</xhtml:li>
          </xhtml:ul>
        </xhtml:p>
      </description>
      <fix system="urn:xccdf:fix:script:sh"><![CDATA[
        LOGFILES="/var/log/wtmp root utmp 664
        	  /var/log/btmp root utmp 600
        	  /var/log/lastlog root root 644
        	  /var/run/utmp root utmp 664
        	  /var/log/messages root root 600"
        
        while name owner group perm
        do
          if [ ! -e $name -o ! -f $name ]
          then
            rm -rf $name
        
            touch $name
            chown $owner $name
            chgrp $group $name
            chmod $perm $name
          fi
        done
      ]]></fix>
      <check system="http://open-scap.org/page/SCE">
        <check-import import-name="stdout"/>
        <check-content-ref href="CHK00_exists.sh"/>
      </check>
    </Rule>

    <Rule id="xccdf_org.open-scap.sce-community-content_rule_services_logging-owner" selected="true">
      <title>Check owner of the log files.</title>
      <description>
        <xhtml:p>Log files should be owned by root.</xhtml:p>
        <xhtml:p>Improper file permissions could compromise the integrity of the log files, defeating their purpose.</xhtml:p>
        <xhtml:p>The following log files will be checked:
          <xhtml:ul>
            <xhtml:li>/var/log/wtmp</xhtml:li>
            <xhtml:li>/var/log/btmp</xhtml:li>
            <xhtml:li>/var/log/lastlog</xhtml:li>
            <xhtml:li>/var/log/utmp</xhtml:li>
            <xhtml:li>/var/log/messages</xhtml:li>
          </xhtml:ul>
        </xhtml:p>
      </description>
      <fix system="urn:xccdf:fix:script:sh"><![CDATA[
        LOGFILES="/var/log/wtmp root utmp 664
            /var/log/btmp root utmp 600
            /var/log/lastlog root root 644
            /var/run/utmp root utmp 664
            /var/log/messages root root 600"
        
        RET=$XCCDF_RESULT_PASS
        
        while name owner group perm
        do
          chown $owner $name
        done
      ]]></fix>
      <check system="http://open-scap.org/page/SCE">
        <check-import import-name="stdout"/>
        <check-content-ref href="CHK01_owner.sh"/>
      </check>
    </Rule>

    <Rule id="xccdf_org.open-scap.sce-community-content_rule_services_logging-group" selected="true">
      <title>Check group of the log files.</title>
      <description>
        <xhtml:p>Log files should be owned by root.</xhtml:p>
        <xhtml:p>Improper file permissions could compromise the integrity of the log files, defeating their purpose.</xhtml:p>
        <xhtml:p>The following log files will be checked:
          <xhtml:ul>
            <xhtml:li>/var/log/wtmp</xhtml:li>
            <xhtml:li>/var/log/btmp</xhtml:li>
            <xhtml:li>/var/log/lastlog</xhtml:li>
            <xhtml:li>/var/log/utmp</xhtml:li>
            <xhtml:li>/var/log/messages</xhtml:li>
          </xhtml:ul>
        </xhtml:p>
      </description>
      <fix system="urn:xccdf:fix:script:sh"><![CDATA[
        LOGFILES="/var/log/wtmp root utmp 664
        	  /var/log/btmp root utmp 600
        	  /var/log/lastlog root root 644
        	  /var/run/utmp root utmp 664
        	  /var/log/messages root root 600"
        
        RET=$XCCDF_RESULT_PASS
        
        while name owner group perm
        do
          chgrp $group $name
        done
      ]]></fix>
      <check system="http://open-scap.org/page/SCE">
        <check-import import-name="stdout"/>
        <check-content-ref href="CHK02_group.sh"/>
      </check>
    </Rule>
  </Group>
</xf:xccdf-fragment>

