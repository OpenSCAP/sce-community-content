<xf:xccdf-fragment xmlns="http://checklists.nist.gov/xccdf/1.2" xmlns:xf="http://fedorahosted.org/sce-community-content/wiki/XCCDF-fragment" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  <Group id="xccdf_org.open-scap.sce-community-content_group_system_execution" selected="true">
    <title>Execution restriction</title>

    <Rule id="xccdf_org.open-scap.sce-community-content_rule_system_execution-exec_shield" selected="true">
      <title>Check if execute shield is enabled.</title>
      <description>
        <xhtml:p>The execute shield kernel option should be enabled in the sysctl configuration file.</xhtml:p>
        <xhtml:p>Enabling execute shield makes the system less easy to exploit by some security vulnerabilities.</xhtml:p>
        <xhtml:p>
          File(s) affected:
          <xhtml:ul>
            <xhtml:li>/etc/sysctl.conf</xhtml:li>
            <xhtml:li>/etc/sysctl.d/*</xhtml:li>
          </xhtml:ul>
        </xhtml:p>
      </description>
      <fix reboot="1" system="urn:xccdf:fix:script:sh">
      
        FOUND=0
        for config in /etc/sysctl.conf /etc/sysctl.d/*
        do
          SETTING=$(cat $config | grep kernel.exec-shield | sed -e 's,[^#= ]\+\s*=\s*\([^#]\+\),\1,g')

          if [ $SETTING -ne 0 ]
          then
            FOUND=1
            sed -i 's,^.*kernel.exec-shield.*$,kernel.exec-shield = 1,' $config
          fi
        done

        if [ $FOUND -eq 0 ]
        then
          echo kernel.exec-shield = 1 &gt;&gt; /etc/sysctl.conf
        fi
      
      </fix>
      <check system="http://open-scap.org/page/SCE">
        <check-import import-name="stdout" />
        <check-content-ref href="exec_shield.sh" />
      </check>
    </Rule>

    <Rule id="xccdf_org.open-scap.sce-community-content_rule_system_execution-va_randomization" selected="true">
      <title>Check if va randomization is enabled.</title>
      <description>
        <xhtml:p>The va randomization kernel option should be enabled in the sysctl configuration file.</xhtml:p>
        <xhtml:p>Enabling va randomization makes the system less easy to exploit by some security vulnerabilities.</xhtml:p>
        <xhtml:p>
          File(s) affected:
          <xhtml:ul>
            <xhtml:li>/etc/sysctl.conf</xhtml:li>
            <xhtml:li>/etc/sysctl.d/*</xhtml:li>
          </xhtml:ul>
        </xhtml:p>
      </description>
      <fix reboot="1" system="urn:xccdf:fix:script:sh">
      
        FOUND=0
        for config in /etc/sysctl.conf /etc/sysctl.d/*
        do
          SETTING=$(cat $config | grep kernel.randomize_va_space | sed -e 's,[^#= ]\+\s*=\s*\([^#]\+\),\1,g')

          if [ $SETTING -ne 0 ]
          then
            FOUND=1
            sed -i 's,^.*kernel.randomize_va_space.*$,kernel.randomize_va_space = 1,' $config
          fi
        done

        if [ $FOUND -eq 0 ]
        then
          echo kernel.randomize_va_space = 1 &gt;&gt; /etc/sysctl.conf
        fi
      
      </fix>
      <check system="http://open-scap.org/page/SCE">
        <check-import import-name="stdout" />
        <check-content-ref href="va_randomization.sh" />
      </check>
    </Rule>
  </Group>
</xf:xccdf-fragment>